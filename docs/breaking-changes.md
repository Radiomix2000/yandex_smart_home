## Переход с 0.x на 1.x

### Прямое подключение: настройки нотификатора { id=v1-notifier }

С версии 1.0 для прямого подключения служба уведомлений о состоянии устройств ([нотификатор](https://docs.yaha-cloud.ru/v0.6.x/advanced/direct-connection/#notifier)) настраивается через [интерфейс](./config/getting-started.md#gui) (раздел `Параметры навыка`), а не YAML конфигурацию.

Параметры из секции `notifier` YAML конфигурации будут перенесены **автоматически** если в ней задан только один навык/пользователь.

Если у вас несколько записей в секции `notifier` (например задействованы несколько пользователей) – необходимо перенести параметры вручную. Для каждого пользователя/навыка потребуется создать отдельную интеграцию с прямым типом подключения.

### Прямое подключение: несколько пользователей/навыков { id=v1-multi-skill }

С версии 1.0 при использовании прямого подключения для каждой пары навык-пользователь требуется создавать отдельную интеграцию. Если в вашем навыке авторизованы разные пользователи, или к вашему HA подключено несколько разных навыков, вы можете получить ошибку `Failed to find Yandex Smart Home integration for request from yandex (user XXX)`.

В этом случае нужно добавить отдельные интеграции с прямым подключением для каждого авторизуемого пользователя.

### Прямое подключение: поддержка Маруси { id=v1-marusia }

Если к вашему Home Assistant уже подключена Маруся, то при обновлении на v1.x она перестанет работать, а в журнале сервера появится ошибка `Failed to find Yandex Smart Home integration for request from vk (user XXX)`

Для её устранения вам нужно [добавить](./install/integration.md) новую интеграцию с типом подключения "Прямое" и платформой умного дома "Маруся". Список устройств для передачи можно скопировать с существующей интеграции.

После добавления интеграции Маруся заработает автоматически (удалять провайдера и добавлять повторно не требуется).

### Состояние для custom_toggles { id=v1-custom-toggles }

Пользовательские умения типа "Переключатели" теперь ожидают бинарные значения (`on/off/yes/no/True/False/1/0`) при определении своего состояния.
До версии 1.0 умение считалось включенным, когда состояние отличалось от `off`.

!!! example "До 1.0"

  ```yaml
  yandex_smart_home:
    entity_config:
      humidifier.humidifier:
        custom_toggles:
          backlight:
            state_entity_id: select.humidifier_led_brightness  # значения high/med/off
  ```

!!! example "После 1.0"

  ```yaml
  yandex_smart_home:
    entity_config:
      humidifier.humidifier:
        custom_toggles:
          backlight:
            state_template: '{{ not is_state("select.humidifier_led_brightness", "off") }}'
  ```

### Параметр pressure_unit { id=v1-pressure-unit }

Параметр `pressure_unit` (раздел `settings`) больше не поддерживается, удалите его из YAML конфигурации.

Теперь компонент автоматически пытается сохранить единицы измерения при передаче значений датчиков из Home Assistant в УДЯ ([подробнее о конвертации значений](devices/sensor/float.md#unit-conversion))

### Клонирование интеграции { id=v1-cloning }

C версии 1.0 [клонирование](https://docs.yaha-cloud.ru/v0.6.x/advanced/clone/) компонента не рекомендуется. Компонент теперь поддерживает добавление нескольких интеграций с разными фильтрами.

### Прочие изменения { id=v1-not-breaking }

Прочие изменения в 1.0 не ломающие обратную совместимость с 0.x:

1. При [настройке режимов](config/modes.md) в параметре `entity_config.*.modes` теперь рекомендуется использовать строки, а не списки. Использование списков допустимо, и менять это не планируется.
2. В настройках интеграции пункт меню "ID и Пароль (облачное подключение)" переименован в "Реквизиты для привязки".
3. Вызовы действий (сервисов) заменены c `service:` на `action:` ([причина](https://www.home-assistant.io/blog/2024/08/07/release-20248/#goodbye-service-calls-hello-actions-)). Поддерживаются оба способа вызова, менять конфигурацию не требуется.

### Даунгрейд { id=v1-downgrade-v0 }

Если вы обновились с 0.x до 1.x и что-то работает не правильно - даунгрейд обратно на 0.x возможен при выполнении нескольких условий:

1. Создана только одна запись интеграции Yandex Smart Home (страница Настройки --> Устройства и службы --> Интеграции --> Yandex Smart Home)
2. В YAML конфигурации не используются новые для 1.x параметры
3. Способ выбор объектов для передачи в УДЯ не изменён на "Через ярлыки на объектах"

Для даунгрейда [скачайте](https://docs.yaha-cloud.ru/dev/install/component/#update) последнюю версию 0.6.х через HACS.
